{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import axios from'axios';import Header from'./Header';import WalletInfo from'./WalletInfo';import ParkingInfo from'./ParkingInfo';import TransactionList from'./TransactionList';import PaymentModal from'./PaymentModal';import ReservationModal from'./ReservationModal';import ParkingLayout from'./ParkingLayout';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Dashboard=()=>{const[user,setUser]=useState(null);const[transactions,setTransactions]=useState([]);const[parkingInfo,setParkingInfo]=useState({totalSlots:8,availableSlots:0,occupiedSlots:0});const[isPaymentModalOpen,setIsPaymentModalOpen]=useState(false);const[isReservationModalOpen,setIsReservationModalOpen]=useState(false);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const navigate=useNavigate();useEffect(()=>{const userData=JSON.parse(localStorage.getItem('user'));if(!userData){navigate('/');return;}setUser(userData);// Fetch user data, transactions, and parking info\nconst fetchData=async()=>{try{setLoading(true);// Fetch updated user data\nconst userResponse=await axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/users/\").concat(userData._id));if(userResponse.data.success){setUser(userResponse.data.user);localStorage.setItem('user',JSON.stringify(userResponse.data.user));}// Fetch transactions\nconst transactionsResponse=await axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/users/\").concat(userData._id,\"/transactions\"));if(transactionsResponse.data.success){setTransactions(transactionsResponse.data.transactions);}// Fetch parking slots info\nconst slotsResponse=await axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/slots/status/available\"));if(slotsResponse.data.success){setParkingInfo({totalSlots:slotsResponse.data.totalSlots,availableSlots:slotsResponse.data.availableSlots,occupiedSlots:slotsResponse.data.occupiedSlots});}}catch(error){console.error('Error fetching dashboard data:',error);setError('Failed to load dashboard data');}finally{setLoading(false);}};fetchData();// Refresh data every 30 seconds\nconst interval=setInterval(fetchData,30000);return()=>clearInterval(interval);},[navigate]);const handleLogout=()=>{localStorage.removeItem('user');navigate('/');};const handlePaymentSuccess=updatedUser=>{setUser(updatedUser);localStorage.setItem('user',JSON.stringify(updatedUser));setIsPaymentModalOpen(false);// Refresh transactions after payment\nconst fetchTransactions=async()=>{try{const response=await axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/users/\").concat(user._id,\"/transactions\"));if(response.data.success){setTransactions(response.data.transactions);}}catch(error){console.error('Error fetching transactions:',error);}};fetchTransactions();};if(loading&&!user){return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-center\",style:{marginTop:'100px'},children:/*#__PURE__*/_jsx(\"h2\",{children:\"Loading...\"})})});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{user:user,onLogout:handleLogout}),/*#__PURE__*/_jsxs(\"div\",{className:\"container dashboard\",children:[error&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"row mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-4\",children:/*#__PURE__*/_jsx(WalletInfo,{user:user,onAddMoney:()=>setIsPaymentModalOpen(true)})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-8\",children:/*#__PURE__*/_jsx(ParkingInfo,{parkingInfo:parkingInfo,onReserve:()=>setIsReservationModalOpen(true)})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"row mb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-md-12\",children:/*#__PURE__*/_jsx(ParkingLayout,{user:user})})}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-md-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Transaction History\"}),/*#__PURE__*/_jsx(TransactionList,{transactions:transactions})]})})})]}),isPaymentModalOpen&&/*#__PURE__*/_jsx(PaymentModal,{user:user,onClose:()=>setIsPaymentModalOpen(false),onPaymentSuccess:handlePaymentSuccess}),isReservationModalOpen&&/*#__PURE__*/_jsx(ReservationModal,{user:user,onClose:()=>setIsReservationModalOpen(false)})]});};export default Dashboard;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","axios","Header","WalletInfo","ParkingInfo","TransactionList","PaymentModal","ReservationModal","ParkingLayout","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Dashboard","user","setUser","transactions","setTransactions","parkingInfo","setParkingInfo","totalSlots","availableSlots","occupiedSlots","isPaymentModalOpen","setIsPaymentModalOpen","isReservationModalOpen","setIsReservationModalOpen","loading","setLoading","error","setError","navigate","userData","JSON","parse","localStorage","getItem","fetchData","userResponse","get","concat","process","env","REACT_APP_API_URL","_id","data","success","setItem","stringify","transactionsResponse","slotsResponse","console","interval","setInterval","clearInterval","handleLogout","removeItem","handlePaymentSuccess","updatedUser","fetchTransactions","response","className","children","style","marginTop","onLogout","onAddMoney","onReserve","onClose","onPaymentSuccess"],"sources":["C:/Users/srajp/Desktop/sunday/client/src/components/Dashboard.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport Header from './Header';\r\nimport WalletInfo from './WalletInfo';\r\nimport ParkingInfo from './ParkingInfo';\r\nimport TransactionList from './TransactionList';\r\nimport PaymentModal from './PaymentModal';\r\nimport ReservationModal from './ReservationModal';\r\nimport ParkingLayout from './ParkingLayout';\r\nconst Dashboard = () => {\r\n  const [user, setUser] = useState(null);\r\n  const [transactions, setTransactions] = useState([]);\r\n  const [parkingInfo, setParkingInfo] = useState({\r\n    totalSlots: 8,\r\n    availableSlots: 0,\r\n    occupiedSlots: 0\r\n  });\r\n  const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(false);\r\n  const [isReservationModalOpen, setIsReservationModalOpen] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const navigate = useNavigate();\r\n  useEffect(() => {\r\n    const userData = JSON.parse(localStorage.getItem('user'));\r\n    if (!userData) {\r\n      navigate('/');\r\n      return;\r\n    }\r\n    setUser(userData); \r\n    // Fetch user data, transactions, and parking info\r\n    const fetchData = async () => {\r\n      try {\r\n        setLoading(true);\r\n        // Fetch updated user data\r\n        const userResponse = await axios.get(`${process.env.REACT_APP_API_URL}/api/users/${userData._id}`);\r\n        if (userResponse.data.success) {\r\n          setUser(userResponse.data.user);\r\n          localStorage.setItem('user', JSON.stringify(userResponse.data.user));\r\n        } \r\n        // Fetch transactions\r\n        const transactionsResponse = await axios.get(`${process.env.REACT_APP_API_URL}/api/users/${userData._id}/transactions`);\r\n        if (transactionsResponse.data.success) {\r\n          setTransactions(transactionsResponse.data.transactions);\r\n        }\r\n        // Fetch parking slots info\r\n        const slotsResponse = await axios.get(`${process.env.REACT_APP_API_URL}/api/slots/status/available`);\r\n        if (slotsResponse.data.success) {\r\n          setParkingInfo({\r\n            totalSlots: slotsResponse.data.totalSlots,\r\n            availableSlots: slotsResponse.data.availableSlots,\r\n            occupiedSlots: slotsResponse.data.occupiedSlots\r\n          });\r\n        } \r\n      } catch (error) {\r\n        console.error('Error fetching dashboard data:', error);\r\n        setError('Failed to load dashboard data');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchData();\r\n    // Refresh data every 30 seconds\r\n    const interval = setInterval(fetchData, 30000);\r\n    return () => clearInterval(interval);\r\n  }, [navigate]);\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('user');\r\n    navigate('/');\r\n  };\r\n  const handlePaymentSuccess = (updatedUser) => {\r\n    setUser(updatedUser);\r\n    localStorage.setItem('user', JSON.stringify(updatedUser));\r\n    setIsPaymentModalOpen(false);\r\n\r\n    // Refresh transactions after payment\r\n    const fetchTransactions = async () => {\r\n      try {\r\n        const response = await axios.get(`${process.env.REACT_APP_API_URL}/api/users/${user._id}/transactions`);\r\n        if (response.data.success) {\r\n          setTransactions(response.data.transactions);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching transactions:', error);\r\n      }\r\n    };\r\n    \r\n    fetchTransactions();\r\n  };\r\n  \r\n  if (loading && !user) {\r\n    return (\r\n      <div className=\"container\">\r\n        <div className=\"text-center\" style={{ marginTop: '100px' }}>\r\n          <h2>Loading...</h2>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <>\r\n      <Header user={user} onLogout={handleLogout} />\r\n      \r\n      <div className=\"container dashboard\">\r\n        {error && <div className=\"alert alert-danger\">{error}</div>}\r\n        \r\n        <div className=\"row mb-4\">\r\n          <div className=\"col-md-4\">\r\n            <WalletInfo \r\n              user={user} \r\n              onAddMoney={() => setIsPaymentModalOpen(true)} \r\n            />\r\n          </div>\r\n          \r\n          <div className=\"col-md-8\">\r\n            <ParkingInfo \r\n              parkingInfo={parkingInfo} \r\n              onReserve={() => setIsReservationModalOpen(true)} \r\n            />\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"row mb-4\">\r\n          <div className=\"col-md-12\">\r\n            <ParkingLayout user={user} />\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"row\">\r\n          <div className=\"col-md-12\">\r\n            <div className=\"card\">\r\n              <h3>Transaction History</h3>\r\n              <TransactionList transactions={transactions} />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {isPaymentModalOpen && (\r\n        <PaymentModal \r\n          user={user}\r\n          onClose={() => setIsPaymentModalOpen(false)}\r\n          onPaymentSuccess={handlePaymentSuccess}\r\n        />\r\n      )}\r\n      \r\n      {isReservationModalOpen && (\r\n        <ReservationModal \r\n          user={user}\r\n          onClose={() => setIsReservationModalOpen(false)}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\nexport default Dashboard; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}